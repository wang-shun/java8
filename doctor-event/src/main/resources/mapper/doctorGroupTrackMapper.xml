<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2016 杭州端点网络科技有限公司, Code Generated by terminus code gen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="DoctorGroupTrack">
    <resultMap id="DoctorGroupTrackMap" type="DoctorGroupTrack">
        <result column="group_id" property="groupId"/>
        <result column="rel_event_id" property="relEventId"/>
        <result column="quantity" property="quantity"/>
        <result column="boar_qty" property="boarQty"/>
        <result column="sow_qty" property="sowQty"/>
        <result column="birth_date" property="birthate"/>
        <result column="avg_day_age" property="avgDayAge"/>
        <result column="weight" property="weight"/>
        <result column="avg_weight" property="avgWeight"/>
        <result column="price" property="price"/>
        <result column="amount" property="amount"/>
        <result column="customer_id" property="customerId"/>
        <result column="customer_name" property="customerName"/>
        <result column="sale_qty" property="saleQty"/>
        <result column="extra" property="extra"/>
        <result column="creator_id" property="creatorId"/>
        <result column="creator_name" property="creatorName"/>
        <result column="updator_id" property="updatorId"/>
        <result column="updator_name" property="updatorName"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        
    </resultMap>

    <sql id="tb">
        doctor_group_tracks
    </sql>

    <sql id="cols_all">
        id, <include refid="cols_exclude_id" />
    </sql>

    <sql id="cols_exclude_id">
        group_id, rel_event_id, quantity, boar_qty, sow_qty, birth_date, avg_day_age, weight, avg_weight, price, amount, customer_id, customer_name, sale_qty, extra, creator_id, creator_name, updator_id, updator_name, created_at, updated_at
    </sql>

    <sql id="vals">
        #{groupId}, #{relEventId}, #{quantity}, #{boarQty}, #{sowQty}, #{birthDate}, #{avgDayAge}, #{weight}, #{avgWeight}, #{price}, #{amount}, #{customerId}, #{customerName}, #{saleQty}, #{extra}, #{creatorId}, #{creatorName}, #{updatorId}, #{updatorName}, now(), now()
    </sql>

    <insert id="create" parameterType="DoctorGroupTrack" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <select id="findById" parameterType="long" resultMap="DoctorGroupTrackMap" >
        SELECT <include refid="cols_all" />
        FROM <include refid="tb" />
        WHERE id = #{id}
    </select>

    <update id="update" parameterType="DoctorGroupTrack">
        UPDATE
        <include refid="tb"/>
        <set>
            <if test="groupId != null">group_id = #{groupId},</if>
            <if test="relEventId != null">rel_event_id = #{relEventId},</if>
            <if test="quantity != null">quantity = #{quantity},</if>
            <if test="boarQty != null">boar_qty = #{boarQty},</if>
            <if test="sowQty != null">sow_qty = #{sowQty},</if>
            <if test="birthDate != null">birth_date = #{birthDate},</if>
            <if test="avgDayAge != null">avg_day_age = #{avgDayAge},</if>
            <if test="weight != null">weight = #{weight},</if>
            <if test="avgWeight != null">avg_weight = #{avgWeight},</if>
            <if test="price != null">price = #{price},</if>
            <if test="amount != null">amount = #{amount},</if>
            <if test="customerId != null">customer_id = #{customerId},</if>
            <if test="customerName != null">customer_name = #{customerName},</if>
            <if test="saleQty != null">sale_qty = #{saleQty},</if>
            <if test="extra != null">extra = #{extra},</if>
            <if test="creatorId != null">creator_id = #{creatorId},</if>
            <if test="creatorName != null">creator_name = #{creatorName},</if>
            <if test="updatorId != null">updator_id = #{updatorId},</if>
            <if test="updatorName != null">updator_name = #{updatorName},</if>

            updated_at=now()
        </set>
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM <include refid="tb"/>
        WHERE id = #{id}
    </delete>

    <select id="findByGroupId" parameterType="long" resultMap="DoctorGroupTrackMap">
        SELECT <include refid="cols_all" />
        FROM <include refid="tb"/>
        WHERE group_id = #{groupId}
    </select>

    <!-- 计算平均日龄, 求当天和出生日期的时间差 + 1 -->
    <update id="incrDayAge" parameterType="list">
        UPDATE <include refid="tb"/>
        SET avg_day_age = TIMESTAMPDIFF(DAY, birth_date, now()) + 1
        WHERE group_id IN
        <foreach collection="list" item="gid" open="(" separator="," close=")">
            #{gid}
        </foreach>
    </update>
</mapper>